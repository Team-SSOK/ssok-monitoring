# values.yaml
image:
  repository: fluent/fluentd-kubernetes-daemonset
  tag: v1.16-debian-opensearch-1
  pullPolicy: IfNotPresent

env:
  - name: FLUENTD_CONF
    value: "fluent.conf"

# Helm에서 ConfigMap 자동 생성
fileConfigs:
  01_sources.conf: |
    <source>
      @type forward
      port 24224
      bind 0.0.0.0
    </source>

  02_filters.conf: ""
  03_dispatch.conf: ""

  04_outputs.conf: |
    <match **>
      @type opensearch
      host opensearch-cluster-master.logging.svc.cluster.local
      port 9200
      scheme http
      index_name fluentd-logs
      logstash_format true
      include_tag_key true
      flush_interval 5s
    
      <buffer>
        @type file
        path /var/log/fluentd-buffers/opensearch
        flush_mode interval
        retry_type exponential_backoff
        flush_interval 5s
        retry_forever
      </buffer>
    </match>

  fluent.conf: ""

service:
  type: ClusterIP
  port: 24224

resources:
  limits:
    memory: 512Mi
    cpu: 200m
  requests:
    memory: 256Mi
    cpu: 100m

extraVolumes:
  - name: buffer-storage
    emptyDir: {}

extraVolumeMounts:
  - name: buffer-storage
    mountPath: /var/log/fluentd-buffers